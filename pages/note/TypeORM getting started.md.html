<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TypeORM getting started | 906bc906</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="TypeORM getting started" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="설치" />
<meta property="og:description" content="설치" />
<link rel="canonical" href="https://906bc906.github.io/jekyll-blog/pages/note/TypeORM%20getting%20started.md" />
<meta property="og:url" content="https://906bc906.github.io/jekyll-blog/pages/note/TypeORM%20getting%20started.md" />
<meta property="og:site_name" content="906bc906" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-10-13T09:16:42+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TypeORM getting started" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-11-22T20:09:20+09:00","datePublished":"2022-10-13T09:16:42+09:00","description":"설치","headline":"TypeORM getting started","mainEntityOfPage":{"@type":"WebPage","@id":"https://906bc906.github.io/jekyll-blog/pages/note/TypeORM%20getting%20started.md"},"url":"https://906bc906.github.io/jekyll-blog/pages/note/TypeORM%20getting%20started.md"}</script>
<!-- End Jekyll SEO tag -->


<meta
  name="keywords"
  content="" />

<link rel="shortcut icon" href="/jekyll-blog/favicon.ico" />
<link rel="apple-touch-icon" href="/jekyll-blog/favicon.ico" />
<link
  rel="alternate"
  type="application/rss+xml"
  title="906bc906 - Second, and Public brain of 906bc906"
  href="/jekyll-blog/feed.xml" />
<link
  rel="stylesheet"
  type="text/css"
  href="/jekyll-blog/assets/css/base.css" />
<link
  rel="stylesheet"
  type="text/css"
  href="/jekyll-blog/assets/css/highlight.css" />

<!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->


<script
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
  async>
</script>


<script src="/jekyll-blog/assets/scripts/jekyllpaper.js" async></script>
<script defer src="/jekyll-blog/assets/scripts/img-remove-md.js"></script>
<script
  src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"
  onload="javascript:loadMermaid();"
  async>
</script>


  </head>
  <body>
    <div class="container-wrapper">
      <header class="container-header">
        <div class="header-info">
  <span class="header-info-name">906bc906</span>
  <span class="header-info-desc">Second, and Public brain of 906bc906</span>
</div>
<nav class="header-nav">
  <ul class="header-main-nav">
    
    <li class="header-main-nav-item">
      <a href="/jekyll-blog/">
        
          All posts
        
      </a>
    </li>
    
    <li class="header-main-nav-item">
      <a href="/jekyll-blog/pages/note/메인%20Main.md">
        
          Index
        
      </a>
    </li>
    
    <li class="header-main-nav-item">
      <a href="/jekyll-blog/feed/pages.xml">
        
          RSS
        
      </a>
    </li>
    
  </ul>
</nav>

      </header>
      <main class="container-main">
        <article class="container-post">
  <div class="post-title">
    <h1>TypeORM getting started</h1>
  </div>
  <div class="post-info">
    <div class="post-date">
      작성일
      2022-10-13 09:16 +09:00
      <br/>
      
        수정일
        2022-11-22 20:09 +09:00
      
    </div>
  </div>
  <ol id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#section">설치</a>
<ol>
<li class="toc-entry toc-h3"><a href="#tsconfigjson">tsconfig.json</a></li>
</ol>
</li>
<li class="toc-entry toc-h2"><a href="#quick-start">Quick Start</a></li>
<li class="toc-entry toc-h2"><a href="#section-1">단계별 가이드</a>
<ol>
<li class="toc-entry toc-h3"><a href="#section-2">모델 생성</a></li>
<li class="toc-entry toc-h3"><a href="#entity-">Entity 생성</a></li>
<li class="toc-entry toc-h3"><a href="#columns-">테이블 Columns 추가</a></li>
<li class="toc-entry toc-h3"><a href="#primary-column-">Primary Column 생성</a></li>
<li class="toc-entry toc-h3"><a href="#auto-generated-column-">auto-generated column 생성</a></li>
<li class="toc-entry toc-h3"><a href="#column--">Column 데이터 타입</a></li>
<li class="toc-entry toc-h3"><a href="#datasource-">새로운 DataSource 생성</a></li>
<li class="toc-entry toc-h3"><a href="#section-3">어플리케이션 실행</a></li>
<li class="toc-entry toc-h3"><a href="#entitymanager--insert">EntityManager로 데이터베이스에 Insert</a>
<ol>
<li class="toc-entry toc-h4"><a href="#no-metadata-for-photo-was-found">No metadata for “Photo” was found</a></li>
</ol>
</li>
<li class="toc-entry toc-h3"><a href="#entity-manager-database-find">Entity Manager로 Database find</a></li>
<li class="toc-entry toc-h3"><a href="#repositories">Repositories</a></li>
<li class="toc-entry toc-h3"><a href="#load">데이터베이스에서 load</a></li>
<li class="toc-entry toc-h3"><a href="#section-4">데이터베이스 업데이트</a></li>
<li class="toc-entry toc-h3"><a href="#section-5">데이터베이스에서 삭제</a></li>
<li class="toc-entry toc-h3"><a href="#section-6">1:1 관계 생성</a></li>
</ol>
</li>
</ol>
  <hr>
  
  <div class="post-author print-post-author">
    <span>906bc906</span>
  </div>
  
  <div class="post-content">
    <h2 id="section">설치</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i typeorm reflect-metadata
npm i &lt;데이터베이스 드라이버, 제 경우 mysql2&gt;
</code></pre></div></div>
<h3 id="tsconfigjson">tsconfig.json</h3>
<p>TS 버전이 4.5 이상인지 확인 및 아래의 설정을 <code>tsconfig.json</code>에 활성화</p>
<pre><code>&quot;emitDecoratorMetadata&quot;: true,
&quot;experimentalDecorators&quot;: true,
</code></pre>
<p><code>lib</code> 섹션에서 <code>es6</code>을 활성화(<code>&quot;lib&quot;: [&quot;ES6&quot;]</code>)시키거나 <code>@types/es6-shim</code> 설치</p>
<h2 id="quick-start">Quick Start</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npx typeorm init <span class="nt">--name</span> MyProject <span class="nt">--database</span> postgres
</code></pre></div></div>
<p>데이터베이스에 사용할 수 있는 목록:</p>
<p><code>mysql</code>, <code>mariadb</code>, <code>postgres</code>, <code>cockroachdb</code>, <code>sqlite</code>, <code>mssql</code>, <code>sap</code>, <code>spanner</code>, <code>oracle</code>, <code>mongodb</code>, <code>cordova</code>, <code>react-native</code>, <code>expo</code>, <code>nativescript</code>.</p>
<p>이미 있는 node project에서 <code>npx typeorm init</code> 도 할 수 있으나 일부 파일을 덮어 쓸 수 있으니 조심해야 함.</p>
<p>새로 만들어진 디렉토리로 이동하여 <code>npm i</code>로 의존성 설치.</p>
<p><code>data-source.ts</code> 파일 수정하여 데이터베이스와 연결.</p>
<h2 id="section-1">단계별 가이드</h2>
<p>이 가이드는 모든 개념들을 ‘얕게’ 다루므로, 해당 내용을 더 자세히 읽고 싶다면 typeorm docs에서 해당 내용을 같이 읽어야 합니다.</p>
<p><img src="attachments/Pasted%20image%2020221013143650.png" alt="" /></p>
<h3 id="section-2">모델 생성</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Photo</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">number</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span>
    <span class="nx">description</span><span class="p">:</span> <span class="kr">string</span>
    <span class="nx">filename</span><span class="p">:</span> <span class="kr">string</span>
    <span class="nx">views</span><span class="p">:</span> <span class="kr">number</span>
    <span class="nx">isPublished</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
</code></pre></div></div>
<p>TypeORM에게 데이터베이스 테이블을 만들게 하기 위해서는 model을 정의해야 한다.</p>
<p>참고로 위와 같이 입력 시</p>
<pre><code>Property '~' has no initializer and is not definitely assigned in the constructor
</code></pre>
<p>와 같은 TS 컴파일 오류가 발생하는데, 찾아낸 해결법은 3가지</p>
<ol>
<li><code>tsconfig.json</code>에서 <code>strictPropertyInitialization</code> 를 <code>false</code>로
<ul>
<li>모든 프로젝트에서 속성 초기화 체크가 비활성화되므로 가능한 피해야 함</li>
</ul>
</li>
<li><code>id!: number</code> 와 같이 <code>!</code> 삽입
<ul>
<li><code>!</code>는 Non-null assertion operator</li>
<li>Null이 아님을 컴파일러에게 알림</li>
</ul>
</li>
<li><code>id?: number</code> 와 같이 <code>?</code> 삽입
<ul>
<li><code>?</code>는 Optional Properties</li>
<li>해당 프로퍼티가 선택적임을 컴파일러에게 알림 (없을 수도 있다)</li>
</ul>
</li>
</ol>
<p>2, 3 중 어느 것이 나은지는 나중에 판단하는 것으로…</p>
<h3 id="entity-">Entity 생성</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Entity</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Photo</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">number</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span>
    <span class="nx">description</span><span class="p">:</span> <span class="kr">string</span>
    <span class="nx">filename</span><span class="p">:</span> <span class="kr">string</span>
    <span class="nx">views</span><span class="p">:</span> <span class="kr">number</span>
    <span class="nx">isPublished</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
</code></pre></div></div>
<p><code>Entity</code>는 <code>@Entity</code> 데코레이터로 장식된 모델이다. 이들로 load, insert, update, remove 등의 작업을 할 수 있다.</p>
<p>데이터베이스는 <code>Photo</code> 엔티티를 위해 테이블을 만들고 이후 앱 어디에서나 사용할 수 있다. 하지만, 현재 상태는 컬럼colmuns이 추가되지 않은 상태다.</p>
<h3 id="columns-">테이블 Columns 추가</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Column</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Photo</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">description</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">filename</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">views</span><span class="p">:</span> <span class="kr">number</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">isPublished</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Entity의 속성을 <code>@Column</code> 데코레이터로 장식하면 Columns로 추가된다.</p>
<p>타입은 이렇게 변환될 것이다.</p>
<table>
<thead>
<tr>
<th align="right">TS 타입</th>
<th align="left">테이블 컬럼 타입</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">number</td>
<td align="left">integer</td>
</tr>
<tr>
<td align="right">string</td>
<td align="left">varchar</td>
</tr>
<tr>
<td align="right">boolean</td>
<td align="left">bool</td>
</tr>
</tbody>
</table>
<p><code>@Column</code> 데코레이터를 이용하여 원하는 타입을 명시적으로 지정할 수도 있다.</p>
<p>이제 남은 것은 Primary Key를 지정하는 것이다.</p>
<h3 id="primary-column-">Primary Column 생성</h3>
<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Column</span><span class="p">,</span> <span class="nx">PrimaryColumn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Photo</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">PrimaryColumn</span><span class="p">()</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span>
		<span class="p">...</span>
</code></pre></div></div>
<p>위와 같이 <code>@PrimaryColumn</code> 데코레이터로 장식하면 column을 primary key로 만들 수 있다.</p>
<h3 id="auto-generated-column-">auto-generated column 생성</h3>
<p>id column이 auto-increment 등으로 자동 생성되길 원한다면, <code>@PrimaryColumn</code> 대신 <code>@PrimaryGeneratedColumn</code> 사용.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Column</span><span class="p">,</span> <span class="nx">PrimaryGeneratedColumn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Photo</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">()</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span>
<span class="p">...</span>
</code></pre></div></div>
<h3 id="column--">Column 데이터 타입</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Column</span><span class="p">,</span> <span class="nx">PrimaryGeneratedColumn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Photo</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">()</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">({</span>
        <span class="na">length</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">(</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">description</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">filename</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">(</span><span class="dl">"</span><span class="s2">double</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">views</span><span class="p">:</span> <span class="kr">number</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">isPublished</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
</code></pre></div></div>
<p>앞서 말했듯 string은 varchar(255)로 매핑된다. 이렇게 기본적으로 매핑되는 데이터베이스 타입이 싫다면 <code>@Column</code> 데코레이터에서 지정해주면 된다.</p>
<p>데이터베이스마다 지원하는 타입이 다르므로 <a href="https://typeorm.io/entities#column-types">문서를 참고</a>한다.</p>
<h3 id="datasource-">새로운 DataSource 생성</h3>
<p><code>DataSource</code>는 데이터베이스와의 연결 설정을 관리하고 초기 데이터베이스 연결 (또는 연결 풀)을 확립한다.</p>
<p>데이터베이스와의 상호작용은 <code>DataSource</code>를 설정한 후에 가능하다.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//index.ts</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">reflect-metadata</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">AppDataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataSource</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">postgres</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">localhost</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span>
    <span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">entities</span><span class="p">:</span> <span class="p">[</span><span class="nx">Photo</span><span class="p">],</span>
    <span class="na">synchronize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">logging</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1">// to initialize initial connection with the database, register all entities</span>
<span class="c1">// and "synchronize" database schema, call "initialize()" method of a newly created database</span>
<span class="c1">// once in your application bootstrap</span>
<span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">initialize</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// here you can start to work with your database</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
</code></pre></div></div>
<p>예제에서는 <code>postgres</code>를 사용했지만, 다른 타입의 데이터베이스를 사용하는 경우 <code>type</code>을 수정하면 된다: <code>mysql</code>, <code>mariadb</code>, <code>postgres</code>, <code>cockroachdb</code>, <code>sqlite</code>, <code>mssql</code>, <code>oracle</code>, <code>sap</code>, <code>spanner</code>, <code>cordova</code>, <code>nativescript</code>, <code>react-native</code>, <code>expo</code>, or <code>mongodb</code></p>
<p>Photo 엔티티를 비롯하여 연결에서 사용하는 엔티티는 <code>entities</code>에 나열되어야 한다.</p>
<p>entities에 나열하는 방법은 여러 가지가 있지만 대표적으로,</p>
<ol>
<li>예제에서처럼 엔티티를 import하여 클래스를 나열하는 방법</li>
<li><code>entities:[&quot;src/models/*.{js, ts}&quot;]</code> 와 같이 특정 디렉토리에 있는 파일들을 엔티티로 import 하는 방법</li>
<li><code>entities:[&quot;../**/*.entity.{js, ts}&quot;</code> 와 같이 모든 디렉토리에서 파일명 뒤에 <code>.entity</code> 를 표시한 js, ts 파일을 모두 import 하는 방법</li>
</ol>
<p>등이 있다.</p>
<h3 id="section-3">어플리케이션 실행</h3>
<p><code>index.ts</code>를 실행하면, 데이터베이스의 커넥션이 초기화되어 데이터베이스 테이블을 생성할 것이다.</p>
<h3 id="entitymanager--insert">EntityManager로 데이터베이스에 Insert</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Photo</span><span class="p">()</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Me and Bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I am near polar bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">filename</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">photo-with-bears.jpg</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">views</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">isPublished</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">manager</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">photo</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Photo has been saved. Photo id is</span><span class="dl">"</span><span class="p">,</span> <span class="nx">photo</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</code></pre></div></div>
<p><code>Datasource</code>로 접근할 수 있는 <code>EntityManager</code>는 모든 엔티티를 insert, update, delete 등으로 관리할 수 있다.</p>
<p>위의 경우 새로운 Photo 인스턴스를 만들어 엔티티 매니저로 save하였다. 위의 경우 데이터베이스에는 없는 새로운 인스턴스를 만들어 save하였으므로 insert 처리된다(있는 인스턴스를 수정하여 save하면 update로 처리).</p>
<h4 id="no-metadata-for-photo-was-found">No metadata for “Photo” was found</h4>
<p>Docs에 작성된 것과 달리 위의 코드를 그대로 실행하면 오류가 발생한다. 문제는 여러가지가 있는데,</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Photo</span><span class="p">()</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Me and Bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I am near polar bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">filename</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">photo-with-bears.jpg</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">views</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">isPublished</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">manager</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">photo</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Photo has been saved. Photo id is</span><span class="dl">"</span><span class="p">,</span> <span class="nx">photo</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</code></pre></div></div>
<ol>
<li>top-level에서의 await</li>
</ol>
<p><code>await AppDataSource.manager.save(photo)</code> 는 top level에서 await를 하고 있는데, 이는 허용되지 않은 표현이다.</p>
<p>async 함수로 따로 빼는 방법도 있고, 필자의 경우엔 즉시실행함수표현(IIFE)으로 처리하였다.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">manager</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">photo</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">photo</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">})()</span>

</code></pre></div></div>
<ol>
<li>DataSource 초기화가 보장되지 않음</li>
</ol>
<p><code>index.ts</code> 에서 <code>AppDataSource</code>를 받아오는데, 이 부분을 잘 보면</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//index.ts</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">reflect-metadata</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">AppDataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataSource</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">postgres</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">localhost</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span>
    <span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">entities</span><span class="p">:</span> <span class="p">[</span><span class="nx">Photo</span><span class="p">],</span>
    <span class="na">synchronize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">logging</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span>

<span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">initialize</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
</code></pre></div></div>
<p>여기도 문제가 좀 많은데, 우선 AppDataSource를 export하지 않았고, export 하더라도 AppDataSource의 Initialize가 export와는 독자적으로 실행된다.</p>
<p>최악의 경우(이미 발생했지만) AppDataSource가 Initialize 되지 않은 상황에서 AppDataSource가 먼저 호출되어 CRUD 등의 작업을 하게 되면, 이때 metadata 오류가 발생하게 된다.</p>
<p>필자가 해결한 방법은 아래와 같다.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">ADSInit</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">isInitialized</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">TypeORM Datasource: Initialized successfully.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>AppDataSource 선언 하단에 아래와 같은 함수를 정의한다.</p>
<p>초기화되지 않은 경우에만 초기화를 하고, 이를 Promise로 반환한다.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="p">{</span>
  <span class="nx">AppDataSource</span><span class="p">,</span>
  <span class="nx">ADSInit</span>
<span class="p">};</span>
</code></pre></div></div>
<p>그리고 export는 AppDataSource와 ADSInit을 모두 한다.</p>
<p><code>app.ts</code> 등 제일 먼저 실행되는 엔트리 파일에서</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ADSInit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./loaders/typeorm-loader</span><span class="dl">"</span><span class="p">;</span>
<span class="p">...</span>
<span class="p">(</span><span class="k">async</span><span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
	<span class="nx">ADSInit</span><span class="p">();</span>
<span class="p">})();</span>
<span class="p">...</span>
</code></pre></div></div>
<p>와 같이 ADSInit이 동기적으로 실행될 수 있도록 보장한다. (앱 최초 1번만 초기화하면 된다)</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./loaders/typeorm-loader</span><span class="dl">"</span><span class="p">;</span>
<span class="p">...</span>
<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">manager</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">})()</span>

</code></pre></div></div>
<p>앱 최초에 초기화를 한 것이 보장되었으므로 이후에는 AppDataSource를 별도 체크 없이 그냥 사용하면 된다.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//app.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span><span class="p">,</span> <span class="nx">ADSInit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Photo</span><span class="p">()</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Me and Bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I am near polar bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">filename</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">photo-with-bears.jpg</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">views</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">isPublished</span> <span class="o">=</span> <span class="kc">true</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">ADSInit</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">manager</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">photo</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">photo</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">})()</span>
</code></pre></div></div>
<p>따라서 예제 코드는 대강 이런 식으로 작성될 것이다. (엔트리 파일 분리가 안 되어 있는 코드라 그냥 ADSInit과 AppDataSource의 매니저 사용을 한 IIFE 안에 넣었지만 분리하는 것이 바람직할듯)</p>
<h3 id="entity-manager-database-find">Entity Manager로 Database find</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">savedPhotos</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">manager</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">Photo</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All photos from the db: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">savedPhotos</span><span class="p">)</span>
</code></pre></div></div>
<p>데이터베이스에 새 Photo들을 저장했으므로 이번에는 데이터베이스에 있는 photo들을 탐색해보자.</p>
<h3 id="repositories">Repositories</h3>
<p><code>EntityManager</code> 대신, <code>Repository</code> 라는 개념을 사용할 것이다. <code>EntityManager</code>가 모든 엔티티를 관리할 수 있다면, <code>Repository</code>는 한정된 엔티티만을 관리한다.</p>
<p>관리하는 엔티티가 많아지는 경우, 이들을 관리하는 것도 헷갈리기 쉬우므로 Repositories로 명확히 나누는 것이 좋다.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Photo</span><span class="p">()</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Me and Bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I am near polar bears</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">filename</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">photo-with-bears.jpg</span><span class="dl">"</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">views</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">photo</span><span class="p">.</span><span class="nx">isPublished</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kd">const</span> <span class="nx">photoRepository</span> <span class="o">=</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">getRepository</span><span class="p">(</span><span class="nx">Photo</span><span class="p">)</span>

<span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">photo</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Photo has been saved</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">savedPhotos</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All photos from the db: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">savedPhotos</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="load">데이터베이스에서 load</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photoRepository</span> <span class="o">=</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">getRepository</span><span class="p">(</span><span class="nx">Photo</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">allPhotos</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All photos from the db: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">allPhotos</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">firstPhoto</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findOneBy</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">First photo from the db: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">firstPhoto</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">meAndBearsPhoto</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findOneBy</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Me and Bears</span><span class="dl">"</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Me and Bears photo from the db: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">meAndBearsPhoto</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">allViewedPhotos</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findBy</span><span class="p">({</span> <span class="na">views</span><span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All viewed photos: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">allViewedPhotos</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">allPublishedPhotos</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findBy</span><span class="p">({</span> <span class="na">isPublished</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All published photos: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">allPublishedPhotos</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">[</span><span class="nx">photos</span><span class="p">,</span> <span class="nx">photosCount</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findAndCount</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All photos: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">photos</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Photos count: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">photosCount</span><span class="p">)</span>
</code></pre></div></div>
<p><code>findOne</code>, <code>findBy</code> 등의 다양한 load 방법을 제공한다.</p>
<h3 id="section-4">데이터베이스 업데이트</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photoRepository</span> <span class="o">=</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">getRepository</span><span class="p">(</span><span class="nx">Photo</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">photoToUpdate</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findOneBy</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">photoToUpdate</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Me, my friends and polar bears</span><span class="dl">"</span>
<span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">photoToUpdate</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="section-5">데이터베이스에서 삭제</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Photo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./entity/Photo</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppDataSource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">photoRepository</span> <span class="o">=</span> <span class="nx">AppDataSource</span><span class="p">.</span><span class="nx">getRepository</span><span class="p">(</span><span class="nx">Photo</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">photoToRemove</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">findOneBy</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">await</span> <span class="nx">photoRepository</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">photoToRemove</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="section-6">1:1 관계 생성</h3>

  </div>
  <hr>
  
    
<script src="https://giscus.app/client.js"
        data-repo="906bc906/jekyll-blog"
        data-repo-id="R_kgDOIKfIuQ"
        data-category="Comment"
        data-category-id="DIC_kwDOIKfIuc4CR3ta"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        crossorigin="anonymous"
        async>
</script>

  
</article>

      </main>
      <footer class="container-footer">
        <div class="footer-copyright">
  <span class="footer-copyright-text float-left">
    Copyright &copy; 2022. 906bc906.
  </span>
  <span class="footer-copyright-text float-right">
    Powered by <a href="https://jekyllrb.com/">Jekyll</a>, themed by <a href="https://github.com/ghosind/Jekyll-Paper-Github">Jekyll-Paper-Github</a>.
  </span>
</div>

      </footer>
    </div>
  </body>
</html>
